name: ğŸ® Discord Notification

on:
  push:
    branches:
      - main

jobs:
  notify:
    name: ğŸ”” Notification Discord
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout du code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ“Š RÃ©cupÃ©ration des informations
        id: commit_info
        run: |
          echo "commit_message=$(git log -1 --pretty=format:'%s' | tr '\n' ' ' | head -c 100)" >> $GITHUB_OUTPUT
          echo "commit_author=$(git log -1 --pretty=format:'%an')" >> $GITHUB_OUTPUT
          echo "commit_date=$(git log -1 --pretty=format:'%ad' --date=format:'%d/%m/%Y Ã  %H:%M')" >> $GITHUB_OUTPUT
          echo "files_changed=$(git diff --name-only HEAD~1 HEAD | wc -l)" >> $GITHUB_OUTPUT
          echo "repo_name=$(echo '${{ github.repository }}' | cut -d'/' -f2)" >> $GITHUB_OUTPUT

      - name: ğŸ”” Message discord
        uses: appleboy/discord-action@master
        with:
          webhook_id: ${{ secrets.DISCORD_WEBHOOK_ID }}
          webhook_token: ${{ secrets.DISCORD_WEBHOOK_TOKEN }}
          color: "#F8DC11"
          username: "ğŸ¤– Bot D. Push"
          avatar_url: "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png"
          message: |
            ğŸš€ **NOUVEAU PUSH MOBILE** ğŸš€
            
            **ğŸ“‹ INFORMATIONS**
            ğŸ“¦ Projet: ${{ steps.commit_info.outputs.repo_name }}
            ğŸ‘¨â€ğŸ’» DÃ©veloppeur: ${{ steps.commit_info.outputs.commit_author }}
            ğŸ“… Date: ${{ steps.commit_info.outputs.commit_date }}

            **ğŸ’¬ COMMIT**
            ğŸ·ï¸ Message: ${{ steps.commit_info.outputs.commit_message }}
            ğŸ“ Fichiers modifiÃ©s: ${{ steps.commit_info.outputs.files_changed }}

